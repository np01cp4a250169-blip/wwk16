package Week16.Scenario;
import java.util.ArrayList;


/**
 * Write a description of class CensusProcessor here.
 *
 * @author (your name)
 * @version (a version number or a date)
 */
public class CensusProcessor
{
    public static Student[] parseCSV(String[] csvData){
        ArrayList<Student> students = new ArrayList<>(); //ArrayList Creation
        
        for(int i=1; i<csvData.length; i++){
            String row = csvData[i];
            String fields[] = row.split(","); //splitting each row and storing in an array
            
            if(fields.length == 6) //only if six fields are available in the data entry
            {
                String name = fields[0].trim();  //removing extra spaces before and after the field entry
                int age = Integer.parseInt(fields[1]); //converts String field into integer value
                String school = fields[2].trim();
                int grade = Integer.parseInt(fields[3]);
                String citizenship = fields[4].trim();
                String phone = fields[5].trim();
                
                Student s = new Student(name, age, school, grade, citizenship, phone); //creating a Student object
                students.add(s); //adding the previously created Student object in the ArrayList
            }
        }
        Student studentArray[] = new Student[students.size()]; //creating an array for elements from the ArrayList
        studentArray = students.toArray(studentArray); //copying the elements from Arraylist to studentArray 
        for(Student s : students)
        {
            System.out.println(s); //prints details of each Student object through toString() method in Student class
        }
        return studentArray;
    }
    
    //search method on the basis of school
    public static Student[] findBySchool(Student[] students, String school)
    {
        ArrayList<Student> result = new ArrayList<>(); //arraylist for storing result when searched
        for(Student s : students)
        {
            if(s.getSchool().equalsIgnoreCase(school))
            {
                result.add(s); //adds details of the student when the search is matched
            }
        }
        return result.toArray(new Student[0]);
    }
    
    //methods that counts number of students of a particular school
    public static int countBySchool(Student[] students, String school)
    {
        int count = 0;
        for(Student s: students)
        {
            if(s.getSchool().equalsIgnoreCase(school))
            {
                count++; //increases student count by 1 when condition is met
            }
        }
        return count;
    }
    
    //method to calculate average age of students
    public static double averageAge(Student[] students)
    {
        double sum = 0;
        for(Student s : students)
        {
            sum += s.getAge(); //adds all the students' age in the loop
        }
        double averageAge = sum / students.length; //divides sum of students' age by number of total students
        return averageAge;
    }
    
    //method to find the name of student having most number of characters
    public static Student findLongestName(Student[] students)
    {
        Student longest = students[0]; //assumes that the first student has the longest name
        for(Student s: students)
        {
            if(s.getName().length() > longest.getName().length()) //checks if the other student has longer name than previous one
            {
                longest = s; //replaces value of 'longest' if another student is found to have longer name than previous one
            }
        }
        return longest;
    }
    
    //method that returns the final report of the census
    public static String generateCensusReport(Student[] students)
    {
        StringBuilder report = new StringBuilder(); 
        
        report.append("\n\n------------- Nepal School Census Report -------------\n"); //title
        int validCount = 0;
        int invalidCount = 0;
        
        report.append(String.format("%-6s %-24s %-8s %-24s %-8s %-15s %-15s\n", "Init", "Name", "Age", "School", "Grade", "Citizenship", "Phone")); //table headings
        report.append("----------------------------------------------------------------------------------------------------------------------------\n");
        for(Student s: students)
        {
            boolean validCit = Validator.isValidCitizenship(s.getCitizenship());
            boolean validPhone = Validator.isValidPhone(s.getPhone());
            
            if(validCit && validPhone)
            {
                validCount++; //increases no. of valid data if the condition meets
            }
            else
            {
                invalidCount++; //increases no. of invalid data
            }
            
            report.append(String.format("%-6s %-24s %-8s %-24s %-8s %-15s %-15s\n",s.getNameInitials(),s.getName(),s.getAge(),s.getSchool(),s.getGrade(),validCit? "VALID" : "INVALID",validPhone? "VALID" : "INVALID"));
        }
        
        //final stats of the census
        report.append("\n---- Statistics ----\n");
        report.append(String.format("Total Students: %-6d Valid: %-6d Invalid: %-6d\n", students.length, validCount, invalidCount));
        report.append(String.format("Average Age: %.2f\n", averageAge(students)));
        report.append(String.format("Longest name: %-20s\n", findLongestName(students)));
        report.append(String.format("%-20s : %-5d", "Itahari Intl College", countBySchool(students,"Itahari Intl College")));
        return report.toString();
    }
}
